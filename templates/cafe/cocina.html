<!doctype html>
<html>

<head>
  <title>Comanda del Cafe</title>
  <meta charset="utf-8">
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <!-- <script crossorigin="anonymous" src="https://kit.fontawesome.com/5020e44799.js"></script> -->
  <link rel="stylesheet" href="{{url_for('static', filename='vendor/font-awesome.min.css')}}" />
  <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}" />
  <link rel="stylesheet" href="{{url_for('static', filename='icons/style.css')}}" />
  <style>
    .caf {
      background-image: repeating-linear-gradient(-45deg, rgba(255, 255, 255, 1.25), rgba(255, 255, 255, 1.25) 1px, transparent 1px, transparent 6px);
      background-color: red;
      background-size: 8px 8px;
    }
  </style>
  <meta http-equiv="refresh" content="7">
</head>

<body>
  {% include 'loader.html' %}
  <script>
    function chAnilla(l, o) {
      console.log(o), document.getElementById(l).style = "background-color: " + o.split(";")[1] + "; color: " + o.split(";")[2]
    }
    function ChangeGroup(el, id) {
      fetch("updategrp?f=" + id + "&v=" + el.value.replace(" ", "%20").replace("#", "%23")).then(() => { location.reload() })
    }
  </script>
  <form method="post">
    <header style="background-color:#000;color:#fff">
      <h3>Pantalla Cocina
        <button onclick='location.href="{{url_for("Cafe.index")}}"' type="button" class="np">Inicio</button>
      </h3>
    </header>
    <main class="grid"
      data-masonry='{ "itemSelector": ".vertical", "horizontalOrder": false, "gutter": 20, "fitWidth": true, "resize": true}'>
      <!-- <?php foreach ($dirs as $dir): ?>
      <?php
        $L_ThisAulaResults = array();
        $files = glob($dir . "/*.json", GLOB_BRACE);
        $fname = end(explode("/", $dir));
        foreach ($files as $file) {
          $POSTT = json_decode(file_get_contents($file), true);
          if (is_array($POSTT['Aula'])) {
            $POSTT['Aula'] = implode(" ", $POSTT['Aula']);
          }
          ;
          if (is_array($POSTT['Anilla'])) {
            $POSTT['Anilla'] = implode(" ", $POSTT['Anilla']);
          }
          ;
          if (is_array($POSTT['Tamaño'])) {
            $POSTT['Tamaño'] = implode(" ", $POSTT['Tamaño']);
          }
          ;
          if (is_array($POSTT['Leche'])) {
            $POSTT['Leche'] = implode(" ", $POSTT['Leche']);
          }
          ;
          if (is_array($POSTT['Temperatura'])) {
            $POSTT['Temperatura'] = implode(" ", $POSTT['Temperatura']);
          }
          ;
          if (is_array($POSTT['Selección'])) {
            $POSTT['Selección'] = implode(" ", $POSTT['Selección']);
          }
          ;
          if (is_array($POSTT['Complementos'])) {
            $POSTT['Complementos'] = implode(" ", $POSTT['Complementos']);
          }
          $L_ThisAulaResults[$file] = $POSTT;

        }
        $sort = array_column($L_ThisAulaResults, "group");
        array_multisort($sort, SORT_DESC, $L_ThisAulaResults);
        ?> -->
      <!-- {% for aula in regiones %}
      <details style="float: left; background-color: yellow; margin: 5px; border: 1px dashed black; padding: 0 25px;">
        <summary>
          <h2 style="margin: 0;">Aula: {{aula}}
          </h2>
        </summary>
      </details>

      {% endfor %} -->

      {% for comanda in comandas %}
      <fieldset class="milk vertical {{comanda[1]['_grupo'].split(';')[3]}}" style="text-shadow: 2px 0 #fff, -2px 0 #fff, 0 2px #fff, 0 -2px #fff, 1px 1px #fff, -1px -1px #fff, 1px -1px
          #fff, -1px 1px #fff; color: black; background-color:
          {{comanda[1]['_grupo'].split(';')[1]}}">


        <h3 style="color: black !important;">
          {{personas[comanda[1]['_persona']]['Nombre']}} ({{personas[comanda[1]['_persona']]['Region']}})
        </h3>
        <select
          style="color: {{comanda[1]['_grupo'].split(';')[2]}}; background-color: {{comanda[1]['_grupo'].split(';')[3]}};"
          id="group" onchange='ChangeGroup(this, "{{comanda[0]}}")' required>
          <option disabled selected>
            {{comanda[1]['_grupo'].split(';')[0]}}
          </option>
          <option value="00 Sin Agrupar;white;black;">00 Sin Agrupar</option>
          <!-- The CSS class "caf" is set at the 4th CSV key -->
          <optgroup label="Sin Cafeina">
          <optgroup label="Sin Cafeina, Pequeño">
            <option value="A1 Peq, Descaf;lightgreen;black;">A1 Peq, Descaf</option>
            <option value="A2 Peq, Descaf;OliveDrab;white">A2 Peq, Descaf</option>
            <option value="A3 Peq, Descaf;darkgreen;white;">A3 Peq, Descaf</option>
          </optgroup>
          <optgroup label="Sin Cafeina, Grande">
            <option value="B1 Grande, Descaf;red;white;">B1 Grande, Descaf</option>
            <option value="B2 Grande, Descaf;orange;white;">B2 Grande, Descaf</option>
            <option value="B3 Grande, Descaf;yellow;black;">B3 Grande, Descaf</option>
          </optgroup>
          </optgroup>
          <optgroup label="Con Cafeina">
          <optgroup label="Con Cafeina, Pequeño">
            <option value="C1 Peq, Con Caf;lightgreen;black;caf">C1 Peq, Con Caf</option>
            <option value="C2 Peq, Con Caf;OliveDrab;white;caf">C2 Peq, Con Caf</option>
            <option value="C3 Peq, Con Caf;darkgreen;white;caf">C3 Peq, Con Caf</option>
          </optgroup>
          <optgroup label="Con Cafeina, Grande">
            <option value="D1 Grande, Con Caf;red;white;caf">D1 Grande, Con Caf</option>
            <option value="D2 Grande, Con Caf;orange;white;caf">D2 Grande, Con Caf</option>
            <option value="D3 Grande, Con Caf;yellow;black;caf">D3 Grande, Con Caf</option>
          </optgroup>
          </optgroup>
        </select>
        <br>
        <label style="background-color: {{personas[comanda[1]['_persona']]['SC_Anilla'].split(';')[1]}};color: transparent;"><br>
            <div class="f fb fn"><span class="background-color:  {{personas[comanda[1]['_persona']]['SC_Anilla'].split(';')[1]}}; display: block; filter: invert(100%); -moz-background-clip: text; -webkit-background-clip: text;">
                {{personas[comanda[1]['_persona']]['SC_Anilla'].split(';')[0]}}
                </span>
            </div>
        </label>
        <br>
        <hr>

        <ul style="padding-left: 17px !important;">
          <li>{{comanda[1].get("Tipo", "")[0]}}

            {% if comanda[1].get("Cafeina", "")[0] != "Sin Elegir" %}
            {{comanda[1].get("Cafeina", "")[0]}}
            {% endif %}

            {% if "Cafe Soluble" in comanda[1]["Tipo"] or "Cafe" in comanda[1]["Tipo"] %}
            <small style="font-size: 10px">10c</small>
            {% endif %}
            <ul style="padding-left: 17px !important;">
              <li>
                {% if comanda[1].get("Leche", "")[0] != "Sin Leche" %}
                {{comanda[1].get("Leche", "")[0]}}
                {% endif %}
                {% if "Grande" in comanda[1]["Tama_o"] %}
                Grande <small style="font-size: 10px">20c</small>
                {% else %}
                Pequeña <small style="font-size: 10px">10c</small>
                {% endif %}
              </li>
              <li>{{comanda[1].get("Temperatura", "")[0]}}</li>
              <li>{{comanda[1].get("Endulzantes", "")[0]}}</li>
            </ul>
          </li>
          {% if "Receta del dia" in comanda[1].get("Complementos", "") %}
          <li>{{Receta}} <small style="font-size: 10px">10c</small></li>
          <li>Servicio <small style="font-size: 10px">10c</small></li>
          {% endif %}

        </ul>

        <hr>
        Total: <b>{{comanda[1].get("_precio", "?")}}c</b>
        <br>Metodo de pago: <b>{{comanda[1].get("MetodoDePago", "")[0]}}</b>

        <hr>
        {{comanda[1].get("notas", "")}}
        <hr><br>
        <button class="nop small" type="button" onclick="location.href='{{url_for('Cafe.rdel', rid=comanda[0])}}'">
          ¡Hecho!</button>
      </fieldset>
      {% endfor %}
    </main>
  </form>
  <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
</body>

</html>