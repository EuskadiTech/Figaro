{{define "content"}}
<div class="container-fluid py-4">
    <h1 class="mb-4">Actividades - {{.Centro}}</h1>
    
    <!-- Tabs Navigation -->
    <div class="mb-4">
        <ul class="nav nav-tabs" id="activitiesTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link {{if eq .ActiveTab "all"}}active{{end}}" href="/actividades?tab=all{{if .SearchQuery}}&q={{.SearchQuery}}{{end}}{{if .ShowPast}}&past=y{{end}}" role="tab">
                    <i class="fas fa-list me-1"></i>
                    Todas las Actividades
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link {{if eq .ActiveTab "compartidas"}}active{{end}}" href="/actividades?tab=compartidas{{if .SearchQuery}}&q={{.SearchQuery}}{{end}}{{if .ShowPast}}&past=y{{end}}" role="tab">
                    <i class="fas fa-share-alt me-1"></i>
                    Compartidas
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link {{if eq .ActiveTab "enlaces"}}active{{end}}" href="/actividades?tab=enlaces{{if .SearchQuery}}&q={{.SearchQuery}}{{end}}{{if .ShowPast}}&past=y{{end}}" role="tab">
                    <i class="fas fa-link me-1"></i>
                    Con Enlaces Personalizados
                </a>
            </li>
        </ul>
    </div>
    
    <!-- Search Form -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="GET" action="/actividades">
                <input type="hidden" name="tab" value="{{.ActiveTab}}" />
                <div class="row g-3 align-items-end">
                    <div class="col-md-6">
                        <label for="search" class="form-label">Buscar actividades</label>
                        <input type="text" id="search" name="q" class="form-control" placeholder="Buscar actividades..." value="{{.SearchQuery}}" />
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search me-1"></i>
                            Buscar
                        </button>
                        <a href="/actividades?tab={{.ActiveTab}}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-1"></i>
                            Limpiar
                        </a>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="past" value="y" id="showPast" {{if .ShowPast}}checked{{end}}>
                            <label class="form-check-label" for="showPast">
                                Mostrar actividades pasadas
                            </label>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    {{if call .HasAccess "actividades.create"}}
    <div class="mb-4">
        <a href="/actividades/crear" class="btn btn-primary">
            <i class="fas fa-plus me-1"></i>
            Crear Nueva Actividad
        </a>
    </div>
    {{end}}

    <div class="activities-section">
        {{if .SearchQuery}}
        <h2 class="mb-3">Resultados de búsqueda para: "{{.SearchQuery}}"</h2>
        {{else if .ShowPast}}
        <h2 class="mb-3">Todas las actividades</h2>
        {{else}}
        <h2 class="mb-3">Próximas actividades</h2>
        {{end}}

        {{if .Activities}}
        <div class="row g-4">
            {{range .Activities}}
            <div class="col-lg-6">
                <div class="card h-100 {{if .IsGlobal}}border-primary{{end}} {{if .SharedFromCenter}}border-info{{end}}">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">{{.Title}}</h5>
                        <div class="d-flex gap-2">
                            {{if .IsGlobal}}
                            <span class="badge bg-primary">
                                <i class="fas fa-globe me-1"></i>
                                Global
                            </span>
                            {{end}}
                            {{if .SharedFromCenter}}
                            <span class="badge bg-info">
                                <i class="fas fa-share-alt me-1"></i>
                                Compartido
                            </span>
                            {{end}}
                        </div>
                    </div>
                    
                    <div class="card-body">
                        {{if .SharedFromCenter}}
                        <div class="alert alert-info alert-sm mb-3">
                            <i class="fas fa-info-circle me-1"></i>
                            <small>Compartido por: <strong>{{.SharedFromCenter}}</strong></small>
                        </div>
                        {{end}}

                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas fa-play-circle text-success me-2"></i>
                                    <div>
                                        <strong>Inicio:</strong><br>
                                        <span class="text-primary fw-bold">{{.StartDatetime.Format "02/01/2006 15:04"}}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas fa-stop-circle text-danger me-2"></i>
                                    <div>
                                        <strong>Fin:</strong><br>
                                        <span class="text-primary fw-bold">{{.EndDatetime.Format "02/01/2006 15:04"}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {{if .Description}}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            {{.Description}}
                        </div>
                        {{end}}

                        <div class="d-flex flex-wrap gap-2">
                            {{if .MeetingURL}}
                            <a href="{{.MeetingURL}}" target="_blank" class="btn btn-sm btn-outline-success">
                                <i class="fas fa-video me-1"></i>
                                Reunión
                            </a>
                            {{end}}
                            {{if .WebURL}}
                            <a href="{{.WebURL}}" target="_blank" class="btn btn-sm btn-outline-info">
                                <i class="fas fa-external-link-alt me-1"></i>
                                Web
                            </a>
                            {{end}}
                            {{range .CustomLinks}}
                            <a href="{{.URL}}" target="_blank" class="btn btn-sm btn-outline-warning">
                                <i class="fas fa-link me-1"></i>
                                {{.Label}}
                            </a>
                            {{end}}
                            {{if call $.HasAccess "actividades.update"}}
                            <a href="/actividades/editar/{{.ID}}" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-edit me-1"></i>
                                Editar
                            </a>
                            {{end}}
                            {{if call $.HasAccess "actividades.delete"}}
                            <form method="POST" action="/actividades/eliminar/{{.ID}}" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('¿Estás seguro de que quieres eliminar esta actividad?')">
                                    <i class="fas fa-trash me-1"></i>
                                    Eliminar
                                </button>
                            </form>
                            {{end}}
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
        </div>

        {{template "pagination" .}}

        {{else}}
        <div class="text-center py-5">
            <div class="card">
                <div class="card-body">
                    <i class="fas fa-tasks text-muted" style="font-size: 4rem;"></i>
                    <h3 class="mt-3 mb-2">No hay actividades programadas</h3>
                    <p class="text-muted mb-4">
                        {{if .SearchQuery}}No se encontraron actividades que coincidan con tu búsqueda.{{else}}Comienza creando una nueva actividad.{{end}}
                    </p>
                    {{if call .HasAccess "actividades.create"}}
                    <a href="/actividades/crear" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i>
                        Crear Primera Actividad
                    </a>
                    {{end}}
                </div>
            </div>
        </div>
        {{end}}
    </div>
</div>
{{end}}