{{define "content"}}
<div class="profile-container">
    <h1>Perfil de Usuario</h1>
    
    {{if .Request.URL.Query.Get "success"}}
    <div style="background-color: #e8f5e8; border: 2px solid #4caf50; color: #2e7d32; padding: 15px; margin: 20px 0; border-radius: 10px; text-align: center;">
        <strong>✅ Éxito:</strong> {{.Request.URL.Query.Get "success"}}
    </div>
    {{end}}

    <div class="user-info">
        <h2>Información Personal</h2>
        <div class="info-grid">
            <div class="info-item">
                <strong>Nombre de Usuario:</strong>
                <span>{{.User.Username}}</span>
            </div>
            <div class="info-item">
                <strong>Nombre Completo:</strong>
                <span>{{.User.DisplayName}}</span>
            </div>
            <div class="info-item">
                <strong>Email:</strong>
                <span>{{.User.Email}}</span>
            </div>
            <div class="info-item">
                <strong>Miembro desde:</strong>
                <span>{{.User.CreatedAt.Format "02/01/2006"}}</span>
            </div>
        </div>
    </div>

    <div class="permissions-info">
        <h2>Permisos</h2>
        <div class="permissions-list">
            {{range .User.Permissions}}
            <span class="permission-badge">{{.}}</span>
            {{end}}
        </div>
    </div>

    <div class="sessions-info">
        <h2>Sesiones Activas</h2>
        <p>Gestiona las sesiones activas en tus dispositivos. Puedes cerrar sesiones individuales o cerrar todas las demás sesiones excepto la actual.</p>
        
        <div class="session-controls">
            <form method="POST" action="/perfil" style="display: inline;">
                <input type="hidden" name="action" value="logout_all_sessions">
                <button type="submit" class="button rojo" onclick="return confirm('¿Estás seguro de que quieres cerrar todas las demás sesiones?')">
                    <img loading="lazy" class="picto" src="/static/pictos/salir.png">
                    Cerrar Sesión en Todos los Dispositivos
                </button>
            </form>
        </div>

        <div class="sessions-table">
            {{if .Sessions}}
            <table>
                <thead>
                    <tr>
                        <th>Dispositivo</th>
                        <th>Dirección IP</th>
                        <th>Última Actividad</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Sessions}}
                    <tr {{if eq .ID $.CurrentSessionID}}class="current-session"{{end}}>
                        <td>
                            <strong>{{.DeviceName}}</strong>
                            {{if eq .ID $.CurrentSessionID}}
                            <span class="current-badge">Actual</span>
                            {{end}}
                            <br>
                            <small style="color: #666;">{{.UserAgent}}</small>
                        </td>
                        <td>{{.IPAddress}}</td>
                        <td>{{.UpdatedAt.Format "02/01/2006 15:04"}}</td>
                        <td>
                            {{if .IsActive}}
                            <span class="status-active">Activa</span>
                            {{else}}
                            <span class="status-inactive">Inactiva</span>
                            {{end}}
                        </td>
                        <td>
                            {{if ne .ID $.CurrentSessionID}}
                            <form method="POST" action="/perfil" style="display: inline;">
                                <input type="hidden" name="action" value="logout_session">
                                <input type="hidden" name="session_id" value="{{.ID}}">
                                <button type="submit" class="button small rojo">
                                    Cerrar Sesión
                                </button>
                            </form>
                            {{else}}
                            <span style="color: #666;">Sesión Actual</span>
                            {{end}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
            {{else}}
            <p>No hay sesiones activas.</p>
            {{end}}
        </div>
    </div>
</div>

<style>
.profile-container {
    max-width: 1000px;
    margin: 20px auto;
    padding: 20px;
}

.user-info, .permissions-info, .sessions-info {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-top: 15px;
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.info-item strong {
    color: #333;
    font-size: 14px;
}

.info-item span {
    color: #666;
    font-size: 16px;
}

.permissions-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
}

.permission-badge {
    background: #e3f2fd;
    color: #1976d2;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 12px;
    font-weight: bold;
}

.session-controls {
    margin: 20px 0;
}

.sessions-table table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.sessions-table th,
.sessions-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.sessions-table th {
    background-color: #f5f5f5;
    font-weight: bold;
}

.current-session {
    background-color: #f0f8ff;
}

.current-badge {
    background: #4caf50;
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: bold;
    margin-left: 10px;
}

.status-active {
    color: #4caf50;
    font-weight: bold;
}

.status-inactive {
    color: #f44336;
    font-weight: bold;
}

.button.small {
    padding: 5px 10px;
    font-size: 12px;
}

@media (max-width: 768px) {
    .info-grid {
        grid-template-columns: 1fr;
    }
    
    .sessions-table table {
        font-size: 14px;
    }
    
    .sessions-table th,
    .sessions-table td {
        padding: 8px;
    }
}
</style>
</div>
{{end}}